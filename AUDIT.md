# PromptPilot â€” Full Project Audit
Generated: 2026-02-23

---

## 1. Confirmed Tech Stack

| Layer | Tech | Version | Status |
|-------|------|---------|--------|
| Frontend framework | React | 18.3.1 (peer dep) | âœ… |
| Router | React Router | 7.13.0 | âœ… |
| State | Zustand (persisted) | ^5.0.11 | âœ… |
| Styling | Tailwind CSS 4 | 4.1.12 | âœ… |
| Build tool | Vite | 6.3.5 | âœ… |
| UI primitives | Radix UI (full suite) | various | âœ… |
| Animation | Motion (Framer) | 12.23.24 | âœ… |
| Backend runtime | Supabase Edge Functions (Deno + Hono) | â€” | âœ… |
| AI provider | Anthropic Claude (`claude-sonnet-4-6`) | â€” | âœ… (server + workflow-engine) |
| Auth + DB | Supabase | `nkdohzkcyovwuktdhmyd` | âœ… |
| Deployment | Vercel (detected via `.env.local`) | hobby plan | âœ… |

**Note:** `package.json` has `name: "@figma/my-make-file"` â€” it was generated by Figma Make. React is listed as an *optional* peerDependency rather than a regular dependency. This is non-standard and could cause issues in some CI environments.

---

## 2. OpenAI / GPT References â€” Full Inventory

### ðŸ”´ ACTIVE OpenAI API calls (must migrate or delete)

| File | Line | Type | Detail |
|------|------|------|--------|
| `supabase/functions/enhance-prompt/index.ts` | 7 | Env var read | `OPENAI_API_KEY = Deno.env.get("OPENAI_API_KEY")` |
| `supabase/functions/enhance-prompt/index.ts` | 8 | Env var read | `OPENAI_MODEL = Deno.env.get("OPENAI_MODEL") \|\| "gpt-4o-mini"` |
| `supabase/functions/enhance-prompt/index.ts` | 79 | Key check | `if (!OPENAI_API_KEY)` |
| `supabase/functions/enhance-prompt/index.ts` | 80 | Log | `console.error("OPENAI_API_KEY not configured")` |
| `supabase/functions/enhance-prompt/index.ts` | 128 | Comment | `// Call OpenAI with timeout protection` |
| `supabase/functions/enhance-prompt/index.ts` | 133 | **Live API call** | `fetch("https://api.openai.com/v1/chat/completions", ...)` |
| `supabase/functions/enhance-prompt/index.ts` | 136 | Auth header | `"Authorization": \`Bearer ${OPENAI_API_KEY}\`` |
| `supabase/functions/enhance-prompt/index.ts` | 140 | Model param | `model: OPENAI_MODEL` |
| `supabase/functions/enhance-prompt/index.ts` | 156 | Log | `console.error("OpenAI API error: ...")` |
| `supabase/functions/enhance-prompt/index.ts` | 170 | Log | `console.error("No content in OpenAI response")` |
| `supabase/functions/enhance-prompt/index.ts` | 203 | Model in response | `model: OPENAI_MODEL` |
| `supabase/functions/enhance-prompt/index.ts` | 217 | Log | `console.error("OpenAI request timeout")` |
| `supabase/functions/enhance-prompt/index.ts` | 219 | Log | `console.error("OpenAI request failed:", ...)` |

**Verdict:** `enhance-prompt` is an entirely OpenAI function. However, it appears to be the **old/legacy function** â€” the live app calls `server/enhance`, not `enhance-prompt/`. The `enhance-prompt` function is NOT called anywhere in the frontend src. It is effectively dead code but still deployed.

### ðŸŸ¡ Product/UI references to ChatGPT (not API calls â€” cosmetic only)

| File | Line | Detail |
|------|------|--------|
| `src/app/pages/LandingPage.tsx` | 155 | UI text: "Use inside ChatGPT" (extension card) |
| `src/app/pages/LandingPage.tsx` | 162 | UI text: "Enhance prompts directly in ChatGPT" |
| `src/app/pages/LandingPage.tsx` | 539â€“542 | `handleUseChatGPT()` opens `https://chat.openai.com/` in new tab â€” this is a product feature, not an API call |
| `src/app/pages/LandingPage.tsx` | 645 | Button label: "Use in ChatGPT" |
| `src/app/pages/LandingPage.tsx` | 790 | UI text: "Use this directly inside ChatGPT" |
| `src/app/pages/LandingPage.tsx` | 951 | `channel: 'ChatGPT'` sent as context to the enhance API |
| `src/app/pages/LandingPage.tsx` | 1223 | UI text: "Use directly inside ChatGPT" |
| `src/app/components/FrameworkCarousel.tsx` | 39 | Testimonial quote mentioning ChatGPT |
| `src/app/components/InteractiveDemo.tsx` | 222 | UI text: "Use inside ChatGPT" |
| `src/app/pages/PromptLibraryNew.tsx` | 301 | Example text: "ChatGPT, Claude, basic prompting" |

**Verdict:** These are all UI/marketing copy â€” no API keys, no actual OpenAI API calls. They represent a product decision to market PromptPilot as a ChatGPT companion. Decision needed: keep (product strategy) or remove.

### âœ… Already migrated

| File | Line | Detail |
|------|------|--------|
| `supabase/functions/server/index.ts` | 1 | Comment: `// Migrated from OpenAI to Anthropic Claude` |

---

## 3. Supabase Edge Functions â€” Full Inventory

### `server` (`/make-server-e52adb92/`)
- **Status:** âœ… Live, migrated to Anthropic Claude
- **Endpoints:**
  - `GET /make-server-e52adb92/health` â€” health check
  - `POST /make-server-e52adb92/enhance` â€” main prompt enhancement (called by LandingPage + PromptInputPage)
  - `POST /make-server-e52adb92/signup` â€” creates user via Supabase Admin API + auto sign-in
- **AI:** Direct REST call to `https://api.anthropic.com/v1/messages` using `ANTHROPIC_API_KEY` + `ANTHROPIC_MODEL`
- **JWT:** `verify_jwt = false` (open endpoint, auth via Supabase anon key)
- **Logic:** Intent detection (keyword rules â†’ override â†’ default `tech`), level resolution (`standard/advanced/expert`), token policy, quality check with one automatic retry, static fallback if API unavailable

### `workflow-engine` (`/workflow-engine/`)
- **Status:** âœ… Built, migrated to Anthropic Claude
- **Endpoints:**
  - `GET /workflow-engine/health` â€” health check
  - `POST /workflow-engine/execute` â€” runs a multi-step workflow definition
- **AI:** Direct REST call to Anthropic API
- **Logic:** `interpolateTemplate()` replaces `{{variable}}` placeholders; `executeWorkflow()` runs steps sequentially, stops on first failure; returns `outputs` map + `trace` per step
- **JWT:** Not configured in `config.toml` (defaults to requiring JWT)

### `enhance-prompt` (`/enhance-prompt/`)
- **Status:** ðŸ”´ DEAD CODE â€” still on OpenAI, NOT called by frontend
- **Endpoints:** `POST /enhance-prompt` (no named path, raw Deno.serve)
- **AI:** OpenAI `gpt-4o-mini` via `OPENAI_API_KEY`
- **Note:** This is the original function before migration. Should be deleted or migrated.

### `mint-token` (`/mint-token/`)
- **Status:** ðŸŸ¡ PLACEHOLDER â€” Deno boilerplate only (`Hello ${name}!`)
- **JWT:** `verify_jwt = true`
- **Logic:** None implemented â€” echoes back a name

### `redeem-token` (`/redeem-token/`)
- **Status:** ðŸŸ¡ PLACEHOLDER â€” Deno boilerplate only (`Hello ${name}!`)
- **JWT:** `verify_jwt = true`
- **Logic:** None implemented â€” echoes back a name

---

## 4. Auth Implementation Status

### What's built

| Feature | File | Status |
|---------|------|--------|
| Google OAuth button | `AuthPage.tsx:40â€“51` | âœ… Code complete |
| Apple OAuth button | `AuthPage.tsx:53â€“64` | âœ… Code complete |
| Email/password sign-in | `AuthPage.tsx:83â€“90` | âœ… Code complete |
| Email/password sign-up | `AuthPage.tsx:72â€“82` | âœ… Code complete |
| OAuth callback handler | `AuthCallbackPage.tsx` | âœ… Code complete |
| Global auth state listener | `App.tsx:41â€“65` | âœ… Code complete |
| Session hydration on mount | `App.tsx:43â€“49` | âœ… Code complete |
| Prompt hydration on login | `App.tsx:8â€“34` | âœ… Code complete |
| Supabase client config | `src/utils/supabase/client.ts` | âœ… `detectSessionInUrl: true`, `persistSession: true` |
| Auth route `/login` | `routes.tsx:23â€“26` | âœ… Wired |
| Callback route `/auth/callback` | `routes.tsx:27â€“30` | âœ… Wired |

### What's NOT done (blocking OAuth)

| Action Required | Where |
|----------------|-------|
| Enable **Google** OAuth provider | Supabase Dashboard â†’ Authentication â†’ Providers â†’ Google (needs Client ID + Secret from Google Cloud Console) |
| Enable **Apple** OAuth provider | Supabase Dashboard â†’ Authentication â†’ Providers â†’ Apple (needs Apple Developer credentials) |
| Add redirect URLs | Supabase Dashboard â†’ Authentication â†’ URL Configuration â†’ Add `http://localhost:5173/auth/callback` and your production URL |

### Auth flow issues found

1. **`AuthPage.tsx` line 8** â€” `REDIRECT_URL = window.location.origin + '/auth/callback'` â€” This is correct for OAuth but hardcoded at module load time. Fine for SPA, but note it won't work in SSR.
2. **`LandingPage.tsx` `SignInModal` (line 802)** â€” There is a duplicate inline sign-in modal on the landing page that only does email/password. After successful sign-in it does `window.location.href = '/app'` (hard redirect) instead of using React Router `navigate`. This bypasses the auth state listener in App.tsx momentarily. Low risk but inconsistent.
3. **No route protection** â€” `/app/*` routes are not guarded. An unauthenticated user can navigate directly to `/app` without being redirected to `/login`.

---

## 5. Environment Variables

### Frontend (local, baked into build)
| Variable | File | Value | Notes |
|----------|------|-------|-------|
| `projectId` | `utils/supabase/info.tsx` | `nkdohzkcyovwuktdhmyd` | Hardcoded, public |
| `publicAnonKey` | `utils/supabase/info.tsx` | `eyJhbG...` | Hardcoded, public â€” OK for anon key |

### Local environment
| Variable | File | Value | Notes |
|----------|------|-------|-------|
| `VERCEL_OIDC_TOKEN` | `.env.local` | JWT token | Vercel deployment token, expires |
| `ANTHROPIC_API_KEY` | Shell | **NOT SET** | Only needed if calling Claude locally |

### Supabase Edge Function Secrets (server-side only)
| Variable | Required By | Status |
|----------|-------------|--------|
| `ANTHROPIC_API_KEY` | `server`, `workflow-engine` | Must be set via `supabase secrets set` â€” unknown if currently set |
| `ANTHROPIC_MODEL` | `server`, `workflow-engine` | Optional, defaults to `claude-sonnet-4-6` |
| `SUPABASE_URL` | `server` (signup endpoint) | Auto-injected by Supabase runtime |
| `SUPABASE_SERVICE_ROLE_KEY` | `server` (signup endpoint) | Auto-injected by Supabase runtime |
| `OPENAI_API_KEY` | `enhance-prompt` (dead) | Should NOT be set â€” function should be deleted |
| `OPENAI_MODEL` | `enhance-prompt` (dead) | Should NOT be set |

---

## 6. What's Working vs Broken

### âœ… Working

- **Core enhance flow** â€” LandingPage â†’ POST `/server/enhance` â†’ Anthropic Claude â†’ result display with improvements, elevate feature, copy
- **Workflow engine** â€” `/workflow-engine/execute` is built and deployed
- **Auth page UI** â€” `/login` renders Google, Apple, email/password forms correctly
- **OAuth callback** â€” `/auth/callback` page exists and handles token detection
- **Auth state management** â€” `App.tsx` global listener + `pilotStore` setAuth/logout/hydratePrompts
- **Saved prompts DB sync** â€” `savePrompt()` upserts to Supabase when authenticated
- **`saved_prompts` table** â€” Migration written, RLS enabled
- **Frontend routing** â€” All routes wired in `routes.tsx`
- **Zustand store** â€” Persisted to localStorage, all actions implemented

### ðŸ”´ Broken / Not Working

| Issue | Severity | Detail |
|-------|----------|--------|
| **Google OAuth fails** | Critical | Provider not enabled in Supabase Dashboard |
| **Apple OAuth fails** | Critical | Provider not enabled in Supabase Dashboard |
| **`enhance-prompt` function uses OpenAI** | High | Dead code but misleading; still deployed; `OPENAI_API_KEY` secret may be expected |
| **No auth guard on `/app` routes** | High | Any visitor can access the authenticated app shell |
| **`LandingPage.tsx` type mismatch** | Medium | `GeneratedResult` interface declares `headline`, `summary`, `prompt_blocks`, `enhanced_prompt_compiled` but the object constructed at line 991 uses `title`, `prompt` â€” TypeScript types are inconsistent with runtime shape |
| **`result.prompt` field** | Medium | `ResultCard` references `result.prompt` (line 530, 702) and `result.title` (line 692) but these don't match the interface definition (which has `headline` and `enhanced_prompt_compiled`) â€” works at runtime only because TS isn't enforced there |
| **Workflow results not surfaced in UI** | Medium | `savedWorkflowResults` stored in Zustand but no page/component renders them |
| **`mint-token` / `redeem-token`** | Low | Both are Hello World stubs â€” do nothing |
| **`/app/workflows` route** | Low | Redirects to `/app` â€” placeholder only |
| **`ANTHROPIC_API_KEY` not confirmed set** | Unknown | Cannot verify Supabase secrets from local environment â€” enhance calls will fall back to static response if missing |
| **Vercel OIDC token in `.env.local`** | Info | Token expires; regenerate if Vercel CLI stops working |

### ðŸŸ¡ Decisions Needed (not bugs, but open questions)

| Item | Detail |
|------|--------|
| **ChatGPT UI references** | The app currently markets itself as a ChatGPT companion ("Use in ChatGPT" buttons, links to `chat.openai.com`). Is this intentional product positioning or leftover from early design? |
| **`server/signup` endpoint** | There's a custom signup endpoint at `POST /make-server-e52adb92/signup` that creates users via Admin API. The `AuthPage.tsx` uses `supabase.auth.signUp()` directly â€” these two paths conflict. Decide which to use and remove the other. |
| **`enhance-prompt` function** | Delete it or migrate it to Anthropic to match `server`? Currently orphaned. |
| **`mint-token` / `redeem-token`** | Implement or delete â€” currently dead weight. |

---

## 7. Summary

The project is **structurally sound** and further along than it might feel. The core AI feature works. The main blockers are:

1. **OAuth not enabled in Supabase Dashboard** â€” 10 minute fix once you have the OAuth credentials
2. **No route protection** â€” unauthenticated users can access `/app`
3. **`enhance-prompt` function is dead OpenAI code** â€” should be deleted
4. **Workflow results have no UI** â€” the engine works but results are invisible to the user

Everything else is polish and product decisions.
